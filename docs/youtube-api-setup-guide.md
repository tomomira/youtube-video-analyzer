# YouTube Data API v3 セットアップガイド

**作成日**: 2025-11-24
**対象者**: 初めてYouTube Data APIを使用する方
**所要時間**: 約10分

---

## 目次
1. [Google Cloud Consoleへのアクセス](#1-google-cloud-consoleへのアクセス)
2. [プロジェクトの作成](#2-プロジェクトの作成)
3. [YouTube Data API v3の有効化](#3-youtube-data-api-v3の有効化)
4. [APIキーの作成](#4-apiキーの作成)
5. [APIキーの制限設定（推奨）](#5-apiキーの制限設定推奨)
6. [APIキーの確認とコピー](#6-apiキーの確認とコピー)
7. [トラブルシューティング](#7-トラブルシューティング)

---

## 前提条件

- Googleアカウントが必要です
- ブラウザ（Chrome、Edge、Firefoxなど）

---

## 1. Google Cloud Consoleへのアクセス

### 手順

1. ブラウザで以下のURLにアクセス
   ```
   https://console.cloud.google.com/
   ```

2. Googleアカウントでログイン
   - 既にログインしている場合はそのまま進む
   - ログインしていない場合はGoogleアカウントでログイン

3. 初回アクセスの場合
   - 「利用規約」が表示される場合は、内容を確認して「同意して続行」をクリック
   - 国を選択（日本）
   - 利用規約にチェックを入れて「同意して続行」

### 画面の見方

- **左上**: ☰（ハンバーガーメニュー）- ナビゲーションメニューを開く
- **上部中央**: プロジェクト選択ドロップダウン
- **右上**: Googleアカウントのアイコン

---

## 2. プロジェクトの作成

### 手順

#### ステップ1: プロジェクト選択画面を開く

1. 画面上部中央の**プロジェクト名**の部分をクリック
   - 初回の場合「プロジェクトを選択」と表示されています
   - または「My First Project」などのデフォルト名が表示されています

2. ポップアップウィンドウが開きます

#### ステップ2: 新しいプロジェクトを作成

1. ポップアップウィンドウの右上にある「**新しいプロジェクト**」ボタンをクリック

2. 「新しいプロジェクト」画面が表示されます

3. 以下の情報を入力：

   **プロジェクト名**（必須）:
   ```
   youtube-video-analyzer
   ```

   **組織**:
   - 個人利用の場合: 「組織なし」を選択（デフォルト）
   - 会社のアカウントの場合: 適切な組織を選択

   **場所**:
   - 「組織なし」のままでOK

4. 「**作成**」ボタンをクリック（画面右下）

#### ステップ3: プロジェクト作成の完了を待つ

1. 「プロジェクトを作成しています...」と表示されます（数秒～10秒程度）

2. 完了すると通知が表示されます
   - 「プロジェクトが作成されました」

3. **重要**: 作成したプロジェクトが選択されていることを確認
   - 画面上部中央に「youtube-video-analyzer」と表示されていればOK
   - 表示されていない場合は、プロジェクト選択ドロップダウンから選択

---

## 3. YouTube Data API v3の有効化

### 手順

#### ステップ1: APIライブラリを開く

**方法A: ナビゲーションメニューから**

1. 画面左上の **☰（ハンバーガーメニュー）** をクリック

2. メニューが開いたら、以下を順にクリック:
   ```
   APIとサービス → ライブラリ
   ```

3. 「APIライブラリ」画面が表示されます

**方法B: 検索バーから（より速い）**

1. 画面上部の検索バーに以下を入力:
   ```
   api library
   ```

2. 検索結果から「**APIとサービス > ライブラリ**」をクリック

#### ステップ2: YouTube Data API v3を検索

1. 「APIライブラリを検索」の検索ボックスに以下を入力:
   ```
   YouTube Data API v3
   ```

2. 検索結果に「**YouTube Data API v3**」が表示されます
   - アイコン: 赤い再生ボタンのアイコン
   - 説明: 「YouTube の動画、プレイリスト、チャンネルを検索、追加、更新、削除します。」

3. 「**YouTube Data API v3**」をクリック

#### ステップ3: APIを有効化

1. API詳細画面が表示されます

2. 画面上部の「**有効にする**」ボタンをクリック
   - ボタンが青色で表示されています
   - 既に有効化されている場合は「管理」ボタンが表示されます

3. 有効化の処理が実行されます（数秒）

4. 完了すると、「API が有効になりました」という通知が表示されます

5. 画面が自動的に「API/サービスの詳細」ページに遷移します

---

## 4. APIキーの作成

### 手順

#### ステップ1: 認証情報画面を開く

**現在のページから遷移する場合:**

1. 「API/サービスの詳細」ページで、上部の「**認証情報を作成**」ボタンをクリック

**または、ナビゲーションメニューから:**

1. 画面左上の **☰（ハンバーガーメニュー）** をクリック

2. メニューから以下を選択:
   ```
   APIとサービス → 認証情報
   ```

#### ステップ2: APIキーを作成

1. 「認証情報」画面の上部にある「**+ 認証情報を作成**」ボタンをクリック

2. ドロップダウンメニューが表示されるので、「**APIキー**」を選択
   - ※「OAuth クライアント ID」や「サービス アカウント」は選択しません

3. ポップアップウィンドウが表示され、「APIキーを作成しました」と表示されます

4. **APIキーが表示されます**（例: `AIzaSyD-xxxxxxxxxxxxxxxxxxxxxxxxxxx`）

5. **重要**: この時点では、まだコピーしないでください
   - 次のステップでAPIキーを制限（セキュリティ強化）します

---

## 5. APIキーの制限設定（推奨）

### なぜ制限が必要？

- セキュリティのため: 不正使用を防ぐ
- コスト管理: 意図しないAPI使用を防ぐ
- ベストプラクティス: Google推奨の設定

### 手順

#### ステップ1: APIキーの編集画面を開く

1. 「APIキーを作成しました」ポップアップで「**キーを制限**」ボタンをクリック

   **または**

2. ポップアップを閉じた場合:
   - 「認証情報」画面のAPIキー一覧から、作成したAPIキーの名前をクリック
   - または、右側の「︙（縦3点）」→「編集」をクリック

#### ステップ2: APIキー名を変更（オプション）

1. 「名前」フィールドに分かりやすい名前を入力（オプション）:
   ```
   YouTube Video Analyzer API Key
   ```

#### ステップ3: アプリケーションの制限

1. 「**アプリケーションの制限**」セクションで以下を選択:

   **選択肢**:
   - ○ **なし** ← **これを選択**
   - ○ HTTP リファラー（ウェブサイト）
   - ○ IP アドレス（ウェブサーバー、cron ジョブなど）
   - ○ Android アプリ
   - ○ iOS アプリ

   **理由**: デスクトップアプリケーションなので「なし」を選択

#### ステップ4: API の制限

1. 「**API の制限**」セクションで以下を選択:

   **選択肢**:
   - ○ キーを制限しない
   - ● **キーを制限** ← **これを選択**

2. 「**キーを制限**」を選択すると、API選択画面が表示されます

3. 「**API を選択**」ドロップダウンをクリック

4. 検索ボックスに「youtube」と入力

5. 「**YouTube Data API v3**」にチェックを入れる
   - ✅ YouTube Data API v3

6. **他のAPIはチェックしない**
   - YouTube Analytics APIなどは不要

#### ステップ5: 保存

1. 画面下部の「**保存**」ボタンをクリック

2. 「API キーが更新されました」という通知が表示されます

---

## 6. APIキーの確認とコピー

### 手順

1. 「認証情報」画面に戻ります

2. 「APIキー」セクションに作成したAPIキーが表示されています

3. APIキーの表示:
   - **キー名**: YouTube Video Analyzer API Key（または設定した名前）
   - **キー**: `AIzaSyD...`（一部が****で隠されている）

4. APIキーをコピー:

   **方法A**: クリップボードにコピー
   - APIキーの右側にある「📋（コピー）」アイコンをクリック
   - 「クリップボードにコピーしました」と表示されます

   **方法B**: 全文を表示してコピー
   - APIキーの右側にある「👁（表示）」アイコンをクリック
   - APIキー全文が表示されるので、選択してコピー

5. **APIキーを安全な場所に保存**
   - テキストファイルに一時的に保存
   - パスワードマネージャーに保存
   - **GitHubやGitには絶対にコミットしない**

### APIキーの形式

正しいAPIキーの形式：
```
AIzaSyD-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

- 先頭: `AIza` で始まる
- 長さ: 39文字
- 文字種: 英数字、ハイフン、アンダースコア

---

## 7. トラブルシューティング

### よくある問題と解決方法

#### Q1. 「プロジェクトを作成」ボタンが見つからない

**原因**: プロジェクト選択画面が開いていない

**解決方法**:
1. 画面上部中央の現在のプロジェクト名をクリック
2. ポップアップウィンドウが開く
3. 右上の「新しいプロジェクト」ボタンをクリック

---

#### Q2. 「YouTube Data API v3」が検索で見つからない

**原因**: 検索キーワードが正確でない

**解決方法**:
1. 検索ボックスに正確に入力: `YouTube Data API v3`
2. または、カテゴリから探す:
   - 「すべてのカテゴリ」→「メディア」→「YouTube Data API v3」

---

#### Q3. 「有効にする」ボタンがグレーアウトしている

**原因**: 既にAPIが有効化されている

**解決方法**:
- 既に有効化されているので、次のステップ（APIキー作成）に進む

---

#### Q4. APIキーを作成したが、どこにあるか分からない

**解決方法**:
1. 左メニュー「APIとサービス」→「認証情報」
2. 「APIキー」セクションにキーが一覧表示されています
3. キーの右側にある「📋（コピー）」アイコンでコピー

---

#### Q5. APIキーを紛失した

**解決方法**:
1. 「認証情報」画面で、該当するAPIキーを確認
2. 「👁（表示）」アイコンで全文を表示
3. コピーして保存

**または**: 新しいAPIキーを作成
1. 「+ 認証情報を作成」→「APIキー」
2. 古いAPIキーは削除可能（右側の︙→削除）

---

#### Q6. 「このAPIは無効です」というエラーが出る

**原因**: YouTube Data API v3が有効化されていない

**解決方法**:
1. 「APIとサービス」→「ライブラリ」
2. 「YouTube Data API v3」を検索
3. 「有効にする」をクリック

---

#### Q7. APIキーの制限を設定したが、動作しない

**原因**: 制限設定が厳しすぎる、または間違っている

**解決方法**:
1. 「認証情報」画面で、APIキーを編集
2. 「アプリケーションの制限」を「なし」に変更
3. 「API の制限」で「YouTube Data API v3」のみが選択されているか確認
4. 保存

---

#### Q8. APIクォータ制限について

**YouTube Data API v3のクォータ**:
- **1日の上限**: 10,000ユニット
- **検索（search.list）**: 100ユニット/回
- **動画詳細（videos.list）**: 1ユニット/回

**対策**:
- 効率的なAPI呼び出し（バッチ処理）
- 不要な検索を避ける
- キャッシュ機能の活用

**クォータ確認方法**:
1. Google Cloud Console
2. 「APIとサービス」→「ダッシュボード」
3. 「YouTube Data API v3」をクリック
4. 「割り当て」タブで使用状況を確認

---

#### Q9. 請求先アカウントの設定を求められる

**原因**: プロジェクトに請求先アカウントが設定されていない

**解決方法**:
1. YouTube Data API v3は無料枠（10,000ユニット/日）があります
2. 請求先アカウントを設定しなくても使用可能です
3. ただし、将来的にクォータを増やす場合は請求先アカウントが必要

**請求先アカウント設定方法**（オプション）:
1. 「お支払い」→「アカウントをリンク」
2. クレジットカード情報を入力
3. 無料枠内であれば課金されません

---

#### Q10. APIキーが漏洩した場合

**対応方法**:
1. **即座に**該当するAPIキーを無効化または削除
   - 「認証情報」画面 → APIキーの右側「︙」→「削除」
2. 新しいAPIキーを作成
3. アプリケーションの設定を更新
4. Gitリポジトリにコミットしていた場合:
   - Gitの履歴から削除（`git filter-branch`など）
   - リポジトリを非公開に変更
   - GitHub Secretsを使用するように変更

---

## 補足情報

### セキュリティのベストプラクティス

1. **APIキーを公開しない**
   - `.env`ファイルに保存
   - `.gitignore`に`.env`を追加
   - GitHubなどに絶対にコミットしない

2. **APIキーを制限する**
   - 使用するAPIのみに制限
   - 可能であればIPアドレスやリファラーで制限

3. **定期的な見直し**
   - 使用していないAPIキーは削除
   - 定期的にローテーション（更新）

### APIキーとOAuth 2.0の違い

| 項目 | APIキー | OAuth 2.0 |
|------|---------|-----------|
| **用途** | 公開データへのアクセス | ユーザーの非公開データへのアクセス |
| **設定の複雑さ** | 簡単 | 複雑 |
| **認証フロー** | 不要 | 必要（ユーザーの同意） |
| **本プロジェクト** | ✅ 使用 | ❌ 不要 |

**今回のプロジェクトではAPIキーのみで十分です。**

---

## 次のステップ

APIキーを取得したら、以下を実施します：

1. **`.env`ファイルの作成**
   - APIキーを安全に保存

2. **動作確認スクリプトの実行**
   - YouTube APIが正しく動作するか確認

3. **Phase 0の残りタスク完了**
   - ショート動画識別方法の調査
   - ロギング設定の実装

---

## 関連ドキュメント

- [YouTube Data API v3 公式ドキュメント](https://developers.google.com/youtube/v3)
- [Google Cloud Console](https://console.cloud.google.com/)
- [API キーのベストプラクティス](https://cloud.google.com/docs/authentication/api-keys)

---

**ドキュメントバージョン**: 1.0
**最終更新日**: 2025-11-24
**フィードバック**: 不明点があれば遠慮なくお知らせください
