# YouTube動画情報収集・Excel/スプレッドシート出力アプリ 要件定義書

## 1. プロジェクト概要

### システム名・プロジェクト名
**YouTube Video Analyzer & Exporter**（YouTube動画分析・エクスポートツール）

### 目的と背景
- **目的**: YouTube上の人気動画を効率的に調査・分析し、マーケティングやコンテンツ企画に活用可能なデータを収集する
- **背景**:
  - コンテンツクリエイターやマーケターが人気動画のトレンドを把握するために、手動で動画を検索・記録する作業が非効率
  - 特定の条件（再生回数、キーワード）で絞り込んだ動画情報を一覧化することで、競合分析やコンテンツ企画の効率化を図る

### 対象ユーザー・ステークホルダー
- **主要ユーザー**:
  - YouTubeコンテンツクリエイター
  - デジタルマーケター
  - 市場調査担当者
  - SNSマーケティング担当者
- **ステークホルダー**: マーケティング部門、コンテンツ企画部門

### プロジェクトのスコープ
- **含まれる範囲**:
  - YouTube動画の検索（通常動画・ショート動画の両方）
  - 再生回数とキーワードによる絞り込み
  - 動画情報（タイトル、再生回数、概要等）の取得
  - Excel/Googleスプレッドシートへのエクスポート
- **含まれない範囲**:
  - 動画のダウンロード機能
  - コメント分析
  - リアルタイムモニタリング
  - 他のSNSプラットフォームへの対応

---

## 2. 機能要件

### 主要機能の一覧と詳細説明

#### F001: 検索条件設定機能【Must】
- **説明**: ユーザーが動画検索の条件を設定する
- **詳細**:
  - キーワード入力（複数キーワード対応、AND/OR検索）
  - 再生回数の下限設定（例: 100万回以上）
  - 再生回数の上限設定（オプション）
  - 動画タイプ選択（通常動画/ショート動画/両方）
  - 公開日範囲の指定（例: 過去1ヶ月、過去1年など）
  - 検索結果の最大件数設定

#### F002: YouTube API連携機能【Must】
- **説明**: YouTube Data APIを使用して動画情報を取得
- **詳細**:
  - API認証（OAuth 2.0またはAPIキー）
  - 検索クエリの実行
  - ページネーション処理（大量結果の取得）
  - レート制限への対応

#### F003: 動画情報取得機能【Must】
- **説明**: 検索結果から必要な動画情報を抽出
- **取得項目**:
  - 動画タイトル
  - 動画URL
  - 再生回数
  - チャンネル名
  - 公開日
  - 動画の説明（概要）の一部または全文
  - いいね数（可能な場合）
  - コメント数（可能な場合）
  - 動画の長さ（尺）
  - タグ情報

#### F004: データフィルタリング・ソート機能【Should】
- **説明**: 取得したデータを条件で絞り込み・並び替え
- **詳細**:
  - 再生回数による降順/昇順ソート
  - チャンネル名によるフィルタリング
  - 公開日によるソート
  - 重複動画の除外

#### F005: Excel/スプレッドシートエクスポート機能【Must】
- **説明**: 取得した動画情報をファイル形式で出力
- **詳細**:
  - Excel形式（.xlsx）でのエクスポート
  - Googleスプレッドシートへの直接書き込み
  - カラムヘッダーの自動生成
  - データの整形（日付フォーマット、数値フォーマット等）
  - ハイパーリンクの埋め込み（動画URLをクリック可能に）

#### F006: 検索履歴保存機能【Could】
- **説明**: 過去の検索条件を保存・再利用
- **詳細**:
  - 検索条件のプリセット保存
  - プリセットの読み込み
  - プリセットの編集・削除

#### F007: 進捗表示機能【Should】
- **説明**: データ取得中の進捗状況を表示
- **詳細**:
  - プログレスバーの表示
  - 取得済み件数の表示
  - 推定残り時間の表示

#### F008: エラーハンドリング機能【Must】
- **説明**: エラー発生時の適切な処理と通知
- **詳細**:
  - API制限エラーの検出と通知
  - ネットワークエラーの処理
  - 不正な入力値の検証とエラーメッセージ表示
  - エラーログの記録

### 各機能の優先順位

| 機能ID | 機能名 | 優先度 | 備考 |
|--------|--------|--------|------|
| F001 | 検索条件設定機能 | Must | コア機能 |
| F002 | YouTube API連携機能 | Must | コア機能 |
| F003 | 動画情報取得機能 | Must | コア機能 |
| F004 | データフィルタリング・ソート機能 | Should | ユーザビリティ向上 |
| F005 | Excel/スプレッドシートエクスポート機能 | Must | コア機能 |
| F006 | 検索履歴保存機能 | Could | 利便性向上 |
| F007 | 進捗表示機能 | Should | UX向上 |
| F008 | エラーハンドリング機能 | Must | システム安定性 |

### 機能間の依存関係
```
F001（検索条件設定）
  ↓
F002（YouTube API連携）
  ↓
F003（動画情報取得）
  ↓
F004（フィルタリング・ソート）※オプション
  ↓
F005（エクスポート）

F007（進捗表示）は F002, F003 と並行動作
F008（エラーハンドリング）は全機能に適用
```

---

## 3. 非機能要件

### パフォーマンス要件
- **応答時間**:
  - UI操作への応答: 0.5秒以内
  - 100件の動画情報取得: 30秒以内（API制限に依存）
  - Excelファイル生成（1000件）: 5秒以内
- **スループット**:
  - YouTube API制限内での最大効率での取得（1日あたり10,000クエリ想定）
  - 同時に複数の検索タスクは実行しない（逐次処理）

### セキュリティ要件
- **認証情報の保護**:
  - YouTube API認証情報の安全な保存（環境変数または暗号化ファイル）
  - Google OAuth 2.0トークンの安全な管理
- **データ保護**:
  - 取得データのローカル保存時の適切な権限設定
  - 個人情報を含む可能性のあるデータの取り扱い注意喚起
- **API使用制限の遵守**:
  - YouTube API利用規約の遵守
  - レート制限の監視と遵守

### 可用性・信頼性
- **可用性**:
  - スタンドアロンアプリケーションのため、ローカル環境で常時利用可能
  - インターネット接続が必要（YouTube API利用のため）
- **信頼性**:
  - API呼び出し失敗時の自動リトライ機能（最大3回）
  - 部分的な結果でも保存可能な仕組み
  - データ取得中断時の途中結果保存

### スケーラビリティ
- 初期バージョンでは単一ユーザー向けデスクトップアプリを想定
- 将来的にWebアプリ化する場合の拡張性を考慮した設計
- 大量データ（10,000件以上）の処理にも対応可能な設計

### 保守性・拡張性
- **コード品質**:
  - モジュール化された設計（API連携、データ処理、UI、エクスポートを分離）
  - 適切なエラーハンドリングとログ出力
  - コメント・ドキュメントの整備
- **拡張性**:
  - 新しいエクスポート形式の追加が容易
  - 取得項目の追加・変更が容易
  - 他のAPIへの対応が可能な設計

### ユーザビリティ
- **操作性**:
  - 直感的なUI（設定→実行→結果確認の3ステップ）
  - 分かりやすいエラーメッセージ
  - ヘルプ・ガイド機能
- **アクセシビリティ**:
  - キーボード操作への対応
  - 適切なフォントサイズとコントラスト
- **多言語対応**: 初期バージョンは日本語のみ、将来的に英語対応も検討

---

## 4. ユースケース・シナリオ

### 主要なユーザーストーリー

#### US-001: トレンド動画の調査
```
As a コンテンツクリエイター
I want to 特定のキーワードで人気の動画を一覧化したい
So that コンテンツ企画の参考にできる
```

**受け入れ基準**:
- キーワード「AI 犬」で100万回以上再生された動画を検索できる
- 結果がExcelファイルとして保存される
- タイトル、再生回数、URLが含まれている

#### US-002: ショート動画の分析
```
As a マーケター
I want to YouTubeショート動画のみを対象に検索したい
So that ショート動画戦略を立案できる
```

**受け入れ基準**:
- ショート動画のみにフィルタリングできる
- 通常動画が結果に含まれない
- 動画の長さが60秒以内であることが確認できる

#### US-003: 定期的なモニタリング
```
As a 市場調査担当者
I want to 同じ検索条件を繰り返し使用したい
So that 定期的なトレンド調査を効率化できる
```

**受け入れ基準**:
- 検索条件をプリセットとして保存できる
- 保存したプリセットを読み込んで再実行できる

### ユースケース図（テキスト記述）

```
[ユーザー]
  |
  |-- (検索条件を設定する)
  |     |
  |     |-- (キーワードを入力する)
  |     |-- (再生回数の下限を設定する)
  |     |-- (動画タイプを選択する)
  |     |-- (公開日範囲を指定する)
  |
  |-- (動画情報を取得する)
  |     |
  |     |-- <<include>> (YouTube APIを呼び出す)
  |     |-- <<include>> (取得進捗を表示する)
  |
  |-- (結果をエクスポートする)
  |     |
  |     |-- (Excel形式で保存する)
  |     |-- (Googleスプレッドシートに書き込む)
  |
  |-- (検索条件を保存する)
  |-- (保存した条件を読み込む)

[YouTube API]
  |
  |-- (動画データを提供する)
```

### 画面遷移フロー

```
[起動画面/メイン画面]
  |
  |-- [検索条件設定エリア]
  |     - キーワード入力フィールド
  |     - 再生回数入力フィールド（下限・上限）
  |     - 動画タイプ選択（ラジオボタンまたはドロップダウン）
  |     - 公開日範囲選択
  |     - 最大取得件数設定
  |     - [検索実行]ボタン
  |     - [プリセット保存]ボタン
  |     - [プリセット読込]ボタン
  |
  ↓ [検索実行]ボタンクリック
  |
[検索実行中画面]
  |     - プログレスバー
  |     - 取得済み件数表示
  |     - [キャンセル]ボタン
  |
  ↓ 検索完了
  |
[結果表示画面]
  |     - データグリッド（テーブル形式で結果表示）
  |     - ソート・フィルタリング機能
  |     - [Excelエクスポート]ボタン
  |     - [スプレッドシートエクスポート]ボタン
  |     - [新規検索]ボタン
  |
  ↓ エクスポートボタンクリック
  |
[エクスポート完了通知]
      - 保存先パスの表示
      - [ファイルを開く]ボタン
      - [閉じる]ボタン
```

---

## 5. データ要件

### 主要なデータモデル・エンティティ

#### E001: SearchCondition（検索条件）
| 属性名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| keyword | String | Yes | 検索キーワード |
| minViews | Integer | Yes | 最小再生回数 |
| maxViews | Integer | No | 最大再生回数 |
| videoType | Enum | Yes | 動画タイプ（ALL/NORMAL/SHORT） |
| publishedAfter | DateTime | No | 公開日以降 |
| publishedBefore | DateTime | No | 公開日以前 |
| maxResults | Integer | Yes | 最大取得件数（デフォルト50） |
| presetName | String | No | プリセット名 |

#### E002: VideoInfo（動画情報）
| 属性名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| videoId | String | Yes | YouTube動画ID |
| title | String | Yes | 動画タイトル |
| url | String | Yes | 動画URL |
| viewCount | Integer | Yes | 再生回数 |
| channelName | String | Yes | チャンネル名 |
| channelId | String | Yes | チャンネルID |
| publishedAt | DateTime | Yes | 公開日時 |
| description | String | No | 動画説明 |
| likeCount | Integer | No | いいね数 |
| commentCount | Integer | No | コメント数 |
| duration | Integer | Yes | 動画の長さ（秒） |
| tags | Array<String> | No | タグ一覧 |
| thumbnailUrl | String | No | サムネイルURL |

#### E003: ExportSettings（エクスポート設定）
| 属性名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| exportFormat | Enum | Yes | 形式（EXCEL/SPREADSHEET） |
| filePath | String | No | 保存先パス（Excel用） |
| spreadsheetId | String | No | スプレッドシートID（GSheet用） |
| sheetName | String | No | シート名 |
| includeColumns | Array<String> | Yes | 出力するカラム一覧 |

#### E004: SearchHistory（検索履歴）
| 属性名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| historyId | String | Yes | 履歴ID |
| searchCondition | SearchCondition | Yes | 検索条件 |
| executedAt | DateTime | Yes | 実行日時 |
| resultCount | Integer | Yes | 取得件数 |

### データの関連性
```
SearchCondition (1) -------- (0..*) VideoInfo
    検索条件1つから複数の動画情報が取得される

SearchCondition (1) -------- (1) ExportSettings
    検索条件1つに対してエクスポート設定が関連

SearchHistory (1) -------- (1) SearchCondition
    履歴1つに対して検索条件が1つ保存される
```

### データの永続化要件
- **SearchCondition（プリセット）**:
  - ローカルJSONファイルまたはSQLite DBに保存
  - ユーザーごとに複数保存可能
- **VideoInfo**:
  - 一時的にメモリに保持
  - エクスポート時にファイルへ書き込み
  - オプションでキャッシュ機能（重複検索の削減）
- **SearchHistory**:
  - ローカルDBに保存（最新100件程度を保持）
- **ExportSettings**:
  - アプリケーション設定として保存（前回値を記憶）

---

## 6. 技術要件・制約事項

### 推奨技術スタック

#### バックエンド/ロジック
- **言語**: Python 3.9以上 または Node.js 16以上
- **YouTube API**: Google YouTube Data API v3
- **Excel操作**:
  - Python: `openpyxl` または `pandas` + `xlsxwriter`
  - Node.js: `exceljs`
- **Google Sheets API**: `gspread` (Python) または Google Sheets API v4 (Node.js)

#### フロントエンド（GUI）
- **デスクトップアプリ**:
  - Python: `Tkinter` または `PyQt5` または `Electron` + Python
  - Node.js: `Electron`
- **代替案**: CLIツールとして実装し、後からGUI追加も可

#### データストレージ
- **軽量DB**: SQLite
- **設定ファイル**: JSON形式

#### 認証
- **YouTube API**: APIキーまたはOAuth 2.0
- **Google Sheets**: OAuth 2.0認証

### 既存システムとの連携要件
- YouTube Data API v3との連携（必須）
- Google Sheets APIとの連携（オプション）
- 既存の社内システムとの連携は不要

### 技術的な制約
- **YouTube API制限**:
  - 1日あたりのクォータ制限（デフォルト10,000ユニット）
  - 検索1回で約100ユニット消費
  - レート制限（1秒あたりのリクエスト数）
- **Google Sheets API制限**:
  - 1分あたり60リクエスト
  - 1セルあたり50,000文字まで
- **動画情報取得の制限**:
  - いいね数・コメント数はAPI設定により取得できない場合がある
  - ショート動画の識別は動画の長さ（60秒以下）で判定
- **インターネット接続必須**: オフラインでは動作不可

### ビジネス上の制約
- **YouTube利用規約の遵守**:
  - 取得データの再配布禁止
  - スクレイピング禁止（必ず公式APIを使用）
- **個人情報保護**:
  - 動画投稿者の個人情報の取り扱いに注意
- **予算制約**:
  - YouTube APIは無料範囲内で使用（有料プランは想定しない）
  - オープンソースライブラリを優先使用

---

## 7. 品質基準

### 受け入れ基準
1. **基本機能**:
   - [ ] キーワードと再生回数を指定して動画を検索できる
   - [ ] 検索結果をExcel形式で保存できる
   - [ ] 保存したExcelファイルが正しく開ける
   - [ ] 最低限のカラム（タイトル、URL、再生回数、チャンネル名、公開日）が含まれる

2. **正確性**:
   - [ ] 指定した再生回数未満の動画が結果に含まれない
   - [ ] 指定したキーワードを含む動画のみが取得される
   - [ ] ショート動画フィルタが正しく機能する

3. **エラーハンドリング**:
   - [ ] API制限エラー時に適切なメッセージが表示される
   - [ ] ネットワークエラー時に適切なエラー処理が行われる
   - [ ] 不正な入力値（負の数など）が検証される

4. **パフォーマンス**:
   - [ ] 100件の動画情報を60秒以内に取得できる
   - [ ] 1000件のExcelエクスポートが10秒以内に完了する

### テスト要件
- **単体テスト**:
  - API呼び出しロジックのテスト（モックAPI使用）
  - データフィルタリング・ソート機能のテスト
  - Excel/CSV生成ロジックのテスト
- **統合テスト**:
  - 実際のYouTube APIを使用したエンドツーエンドテスト
  - エクスポートファイルの整合性確認
- **UI/UXテスト**:
  - 実際のユーザーによる操作性テスト
  - エラーメッセージの分かりやすさ確認
- **負荷テスト**:
  - 大量データ（1000件以上）の取得・処理テスト
  - API制限に達した場合の動作確認

### 成功指標（KPI）
- **機能的指標**:
  - 検索成功率: 95%以上
  - エクスポート成功率: 99%以上
- **パフォーマンス指標**:
  - 平均検索時間（100件）: 30秒以内
  - エクスポート時間（1000件）: 5秒以内
- **ユーザー満足度**:
  - 操作の分かりやすさ: ユーザーテストで80%以上が「分かりやすい」と評価
  - エラーメッセージの理解度: 90%以上が適切に対処できる

---

## 8. リスクと課題

### 想定されるリスク

#### R001: YouTube API制限によるサービス中断【高】
- **内容**: 1日のクォータ上限に達し、検索が実行できなくなる
- **影響度**: 高
- **発生確率**: 中
- **対応策**:
  - クォータ使用量の監視機能を実装
  - ユーザーに1日の検索回数制限を通知
  - 効率的なAPI呼び出し（バッチ処理）を実装
  - 複数のAPIキーローテーション機能（要検討）

#### R002: YouTube API仕様変更【中】
- **内容**: APIのバージョンアップや仕様変更により動作不良が発生
- **影響度**: 高
- **発生確率**: 低
- **対応策**:
  - API変更の監視とアップデート計画
  - エラーログの詳細な記録
  - 互換性を保つための抽象化レイヤーの実装

#### R003: 大量データ処理によるメモリ不足【中】
- **内容**: 数千件以上のデータ取得時にメモリが不足
- **影響度**: 中
- **発生確率**: 中
- **対応策**:
  - ストリーミング処理の実装
  - バッチ処理での段階的エクスポート
  - 最大取得件数の制限設定

#### R004: 認証情報の漏洩【高】
- **内容**: APIキーやOAuthトークンが不適切に管理され漏洩
- **影響度**: 高
- **発生確率**: 低
- **対応策**:
  - 環境変数での管理
  - .gitignoreへの認証ファイル追加
  - 暗号化保存の実装
  - ユーザーガイドでのセキュリティ注意喚起

#### R005: ショート動画の誤判定【低】
- **内容**: 動画の長さだけでショート動画を判定するため誤判定が発生
- **影響度**: 低
- **発生確率**: 中
- **対応策**:
  - YouTube APIの最新情報を確認し、ショート動画識別用のフラグがあれば使用
  - ユーザーに判定基準を明示

### 未解決の課題
- YouTube APIのショート動画専用識別子の有無（要調査）
- 大規模データ取得時のAPI制限回避方法
- Googleスプレッドシート書き込み時のパフォーマンス最適化

---

## 9. 今後の検討事項

### 要件が不明確な部分

#### Q001: 出力するExcel/スプレッドシートの詳細フォーマット
- **確認事項**:
  - カラムの順序に希望はあるか
  - セルの書式設定（日付形式、数値のカンマ区切り等）の要望
  - ヘッダー行の色分けやフィルタ設定の必要性
  - 複数シートへの分割が必要か（例: ショート動画と通常動画で別シート）
- **仮定**:
  - 基本的なテーブル形式で出力
  - ヘッダー行は太字
  - URLはハイパーリンク化

#### Q002: 「簡易的な内容」の具体的な定義
- **確認事項**:
  - 動画の説明文（description）の全文か、要約か、一部抜粋か
  - 文字数制限はあるか（例: 最初の100文字）
  - 改行やHTMLタグの処理方法
- **仮定**: 説明文の最初の200文字を取得

#### Q003: アプリケーションの提供形態
- **確認事項**:
  - デスクトップアプリ（Windows/Mac/Linux）が必要か
  - Webアプリケーションでも可か
  - CLIツールでも可か
- **仮定**: デスクトップアプリ（クロスプラットフォーム対応）

#### Q004: 検索結果の最大件数
- **確認事項**:
  - 一度に取得する最大件数の上限（API制限も考慮）
  - 大量データ取得時の処理方法（分割取得、進捗保存等）
- **仮定**: 最大500件まで、それ以上は警告表示

#### Q005: 複数キーワードの扱い
- **確認事項**:
  - 「AI 犬」はAND検索か、OR検索か
  - 除外キーワードの指定は必要か
  - フレーズ検索（完全一致）の必要性
- **仮定**: スペース区切りでAND検索

### ステークホルダーに確認が必要な事項
1. **予算とスケジュール**: 開発期間と予算の確認
2. **利用規模**: 想定ユーザー数、同時利用者数
3. **運用体制**: サポート体制、アップデート頻度
4. **優先機能**: Must機能以外の優先順位の最終確認
5. **セキュリティポリシー**: 社内セキュリティ基準との整合性

### 追加調査が必要な項目
1. **YouTube API最新仕様**:
   - ショート動画専用の識別フィールドの有無
   - 最新のクォータ制限とコスト
2. **競合ツール調査**:
   - 類似ツールの機能と価格
   - ベストプラクティスの確認
3. **技術検証**:
   - 大量データ処理時のパフォーマンステスト
   - Google Sheets API書き込み速度の実測
4. **法的確認**:
   - YouTube利用規約の詳細確認
   - 取得データの商用利用可否

---

## 補足: 仮定の明記

本要件定義書は以下の仮定に基づいて作成されています：

1. **アプリケーション形態**: デスクトップアプリケーション（Windows/Mac/Linux対応）
2. **ユーザー数**: 個人または小規模チーム向け（10名以下）
3. **データ量**: 1回の検索で最大500件程度を想定
4. **利用頻度**: 1日数回程度の検索を想定
5. **予算**: 無料範囲内での開発・運用（YouTube API無料枠内）
6. **開発言語**: Python（Tkinter or PyQt）またはElectron + Node.js
7. **エクスポート形式**: Excel（.xlsx）を主、Googleスプレッドシートは副次的機能
8. **認証方法**: YouTube APIキー方式を推奨、OAuth 2.0はオプション

これらの仮定が実際の要求と異なる場合は、要件定義の修正が必要です。

---

**要件定義書バージョン**: 1.0
**作成日**: 2025-11-24
**次回レビュー予定**: ステークホルダー確認後
